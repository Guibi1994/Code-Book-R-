---
title: "Code Book ver 2.0"
author: ""
date: '2022-07-03'
output: github_document
---

# Fundamentos de Web-scraping en R

*Web scraping* o web harvesting hace referencia al conjutno de técnicasl empleadas para extraer información en la wed que no esta necesariamente empaquetada en un objeto o archivo consumible de manera directa .

```{r librerias, echo=TRUE, message=FALSE, warning=FALSE}

# libreiras
library(dplyr)
library(rvest) # para web scraping
library(ggplot2)

library(kableExtra)
library(tidyr)

```

## Estructura de un HTML

Los documentos **HTML** (*Hypert Text Markup*) son archivos estructurados que contienen una semántica regular, y son los que por lo general podemos observar detrás de las páginas web (la mayoria de ellas). Si dentro de una págian web damos "click secudnario" y luego "inspecionar" (o tambien "**Ctrl+u**"), podemos ver con clairdad el documetno HTMl detras de ella.

<p align="center">
<img src="00_Code_Book_2.0_files/figure-gfm/prueba.png" alt="Preuba" width="540"/>
</p>

HTML como lenguaje de porgramación tiene una sintaxis y una estructura lógica. Una muestra de esto es que cada uno de los **elementos** de una documento HTML esta **encapsulado** en un "**nodo**". Por ejemplo, el título de un documento HTML esta codificado así: `<title>"Un gran titulo"</titile>` en donde `<title>` es el nodo del titulo. Esta estructura de "nodos" nos permite detectar patrones y elementos puntuales dentro de estos documentos.

<p align="center">
<img src="00_Code_Book_2.0_files/figure-gfm/prueba2.png" alt="estructura_html" width="484"/>
</p>

Algunos elementos con sus tespectivos "***tags***" (nombre del nodo) comúnes en un documento HTML son:

-   `<!DOCTYPE html>` : Declaración del tipo de docuento (en este caso un HTML)

-   `<head>` : Contiene metadata sobre la pagina HTML

-   `<title>` : El titulo de la pagina en cuestion (el que finalmente se muestra en el buscador/browser)

-   `<body>` :

Otros tags comunes son `<table>`, `<fig>`, `<table>`, `<table>`, etc...

## Web scraping de tablas

En este ejemplo utilizaremos la página web de [Wilkipedia del PIB (Prodcucto Interno Bruto) por paises](https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal) "¡Haz click aqui!"), para emplear las técnicas básicas de web scrping en **R**.

```{r primer_paso}

# 1. Leemos el link a explorar

h <- read_html("https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)")
class(h)
```

# Notas sobre data/wrangling

```{r, results='asis', fig.align='center'}

#  Base inicial
nivel_edu <- data.frame(
  pais = c(sample("Colombia",5,T),sample("Peru",5,T),sample("Venezuela",5,T)),
  materia = c("matematicas","lenguaje", "ingles", "fisica", "quimica"),
  p_2014 = rnorm(15,50,15),
  p_2016 = rnorm(15,55,10),
  p_2018 = rnorm(15,54,13),
  p_2020 = rnorm(15,61,8),
  p_2022 = rnorm(15,67,19))

nivel_edu %>% kable() 
```

```{r, results='asis'}

nivel_edu %>%  pivot_longer(starts_with("p_"), "periodo",values_to = "notas")
```

#### gather()

-   key = "nombre" de las variable ID

-   value = "nombre" de la variable de valor

-   .../ c(...) = selección de las variables ID
